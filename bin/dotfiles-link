#!/bin/bash

set -euf -o pipefail

abs_dirname() {
	local cwd
	local path
	local name

	cwd="$(pwd)"
	path="$1"

	while [ -n "$path" ]; do
		cd "${path%/*}"
		name="${path##*/}"
		path="$(readlink "$name")"
	done

	pwd
	cd "$cwd"
}

bin="$(abs_dirname "$0")"
dotfiles="$(abs_dirname "$bin")"

for src in "$dotfiles"/*; do
	ln -hfs "$src" "$HOME/.$(basename "$src")"
done

pushd "$dotfiles" >/dev/null
