#!/bin/bash

set -euf -o pipefail
set -x

# See <https://wiki.archlinux.org/title/XDG_Base_Directory#Supported>

if [ ! -L "$HOME/.cache" ] && [ -d "$HOME/.cache" ]; then
	if [ -d "$HOME/Library/Caches" ]; then
		ln -s "$HOME/Library/Caches" "$HOME/.cache"
	fi
fi

if [ ! -L "$HOME/.cups" ] && [ -d "$HOME/.cups" ]; then
	if [ -d "$HOME/Library/Application Support" ]; then
		mv "$HOME/.cups" "$HOME/Library/Application Support/cups"
		ln -s "$HOME/Library/Application Support/cups" "$HOME/.cups"
	elif [ -d "$XDG_CONFIG_HOME" ]; then
		mv "$HOME/.cups" "$XDG_CONFIG_HOME/cups"
		ln -s "$XDG_CONFIG_HOME/cups" "$HOME/.cups"
	fi
fi

if [ ! -L "$HOME/.bash_history" ] && [ -f "$HOME/.bash_history" ]; then
	if [ -d "$XDG_STATE_HOME" ]; then
		mkdir -p "$XDG_STATE_HOME/bash"
		cat "$HOME/.bash_history" >>"$XDG_STATE_HOME/bash/history"
		rm "$HOME/.bash_history"
		ln -s "$XDG_STATE_HOME/bash/history" "$HOME/.bash_history"
	fi
fi

if [ ! -L "$HOME/.bash_sessions" ] && [ -d "$HOME/.bash_sessions" ]; then
	if [ -d "$XDG_STATE_HOME" ]; then
		mkdir -p "$XDG_STATE_HOME/bash"
		mv "$HOME/.bash_sessions" "$XDG_STATE_HOME/bash/sessions"
		ln -s "$XDG_STATE_HOME/bash/sessions" "$HOME/.bash_sessions"
	fi
fi
