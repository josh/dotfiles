#!/bin/bash

set -euf -o pipefail

if [ "$#" -eq 1 ]; then
	ecid="$(echo "$1" | cut -d '#' -f 1)"
	cid="$(echo "$1" | cut -d '#' -f 2)"
elif [ "$#" -eq 2 ]; then
	ecid="$1"
	cid="$2"
else
	exit 1
fi

key="$(ipfs cid format -b base16 -f "%D" "$cid")"

ipfs cat "$ecid" | openssl enc -aes-256-cbc -d -K "$key" -iv ""
